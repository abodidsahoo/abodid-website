---
import PhotographyCard from "./PhotographyCard.astro";

const { projects, direction = "left", fullWidth = false } = Astro.props;

// Duplicate projects to ensure smooth infinite loop
// We need enough breadth to fill screen + overflow
const duplicatedProjects = [...projects, ...projects, ...projects];

const animationDirection = direction === "right" ? "reverse" : "normal";
---

<div class:list={["carousel-wrapper", { "full-bleed": fullWidth }]}>
    <div
        class="carousel-track"
        style={`animation-direction: ${animationDirection};`}
    >
        {
            duplicatedProjects.map((project, index) => (
                <div class="carousel-item" aria-hidden="true">
                    <PhotographyCard
                        title={project.title}
                        category={
                            Array.isArray(project.category)
                                ? project.category[0]
                                : project.category
                        }
                        image={project.image}
                        images={project.images}
                        href={project.href}
                    />
                </div>
            ))
        }
    </div>
</div>

<style>
    .carousel-wrapper {
        width: 100%; /* Default to contained */
        overflow: hidden;
        position: relative;
        padding: 2rem 0;

        /* Fade edges - wider fade (15%) to blend smoothly */
        -webkit-mask-image: linear-gradient(
            to right,
            transparent,
            black 15%,
            black 85%,
            transparent
        );
        mask-image: linear-gradient(
            to right,
            transparent,
            black 15%,
            black 85%,
            transparent
        );
    }

    .carousel-wrapper.full-bleed {
        width: 100vw;
        margin-left: 50%;
        transform: translateX(-50%);
    }

    .carousel-track {
        display: flex;
        gap: 2rem;
        width: max-content;
        animation: scroll 60s linear infinite;
    }

    /* Pause on hover for interaction */
    .carousel-track:hover {
        animation-play-state: paused;
    }

    .carousel-item {
        width: 400px; /* Fixed width for consistency */
        flex-shrink: 0;
        transition: transform 0.3s ease;
    }

    .carousel-item:hover {
        transform: scale(1.02);
    }

    @keyframes scroll {
        0% {
            transform: translateX(0);
        }
        100% {
            /* Move exactly 1/3 of the track (one set of original items) */
            transform: translateX(calc(-100% / 3));
        }
    }

    @media (max-width: 768px) {
        .carousel-item {
            width: 300px;
        }
        .carousel-track {
            gap: 1.5rem;
            animation-duration: 40s;
        }
    }
</style>
