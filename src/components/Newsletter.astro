---

---

<div class="newsletter-form-wrapper">
    <form class="newsletter-form" id="newsletter-form">
        <input
            type="email"
            name="email"
            placeholder="Enter your email"
            aria-label="Email address"
            required
        />
        <button type="submit" aria-label="Subscribe">
            <svg
                class="arrow-icon"
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><line x1="5" y1="12" x2="19" y2="12"></line><polyline
                    points="12 5 19 12 12 19"></polyline></svg
            >
        </button>
    </form>
    <p class="message" id="newsletter-message"></p>
</div>

<script>
    const form = document.getElementById("newsletter-form");
    const messageEl = document.getElementById("newsletter-message");

    if (form) {
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(form as HTMLFormElement);

            // Visual feedback
            const btn = form.querySelector("button");
            if (!btn) return;

            const originalContent = btn.innerHTML;

            // Just show a simple dot or something minimal while loading, or keep arrow but stop animation
            btn.classList.add("loading");

            try {
                const response = await fetch("/api/subscribe", {
                    method: "POST",
                    body: formData,
                });
                const data = await response.json();

                if (messageEl) {
                    messageEl.textContent = data.message;
                    messageEl.classList.add(response.ok ? "success" : "error");
                }

                if (response.ok) {
                    (form as HTMLFormElement).reset();
                }
            } catch (error) {
                if (messageEl) {
                    messageEl.textContent =
                        "Something went wrong. Please try again.";
                    messageEl.classList.add("error");
                }
            } finally {
                btn.classList.remove("loading");

                // Clear message after 5 seconds
                if (messageEl) {
                    setTimeout(() => {
                        messageEl.textContent = "";
                        messageEl.className = "message";
                    }, 5000);
                }
            }
        });
    }
</script>

<style>
    .newsletter-form-wrapper {
        margin-top: 1rem;
        width: 100%;
        max-width: 350px;
    }

    .newsletter-form {
        display: flex;
        align-items: center;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px; /* Clean box */
        transition: all 0.3s ease;
        padding: 0;
        position: relative;
    }

    .newsletter-form:focus-within {
        border-color: #fff;
        background: rgba(255, 255, 255, 0.05); /* Bit of glue/fill */
    }

    input {
        flex: 1;
        background: transparent;
        border: none;
        padding: 0.8rem 1rem;
        color: #fff;
        font-family: "Inconsolata", monospace; /* Monospace request */
        font-size: 0.9rem;
        outline: none;
        min-width: 0; /* Prevent overflow */
    }

    input::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    button {
        background: transparent;
        border: none;
        color: #fff;
        cursor: pointer;
        padding: 0.8rem 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.3s ease;
    }

    button:hover {
        opacity: 0.8;
    }

    /* Animated Arrow logic */
    .arrow-icon {
        display: block;
        animation: arrowMove 2s infinite ease-in-out;
    }

    @keyframes arrowMove {
        0%,
        100% {
            transform: translateX(0);
        }
        50% {
            transform: translateX(3px); /* Subtle right movement */
        }
    }

    button.loading .arrow-icon {
        animation: none;
        opacity: 0.5;
    }

    .message {
        font-size: 0.75rem;
        margin-top: 0.5rem;
        min-height: 1.2em; /* Prevent layout jump */
        transition: all 0.3s ease;
        font-family: "Inconsolata", monospace;
    }

    .message.success {
        color: #2ecc71;
    }
    .message.error {
        color: #e74c3c;
    }
</style>
