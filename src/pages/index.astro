---
export const prerender = true;
import BaseLayout from '../layouts/BaseLayout.astro';
import StoryCard from '../components/StoryCard.astro';
import { getFeaturedStories, getRecentPosts } from '../lib/api';
import { featuredStories as mockStories, recentPosts as mockRecent } from '../utils/mockData';

const pageTitle = "Home";

// Helper to safely fetch data
const safeFetch = async (fn, fallback) => {
  try {
    return await fn();
  } catch (e) {
    console.error('Data fetch failed:', e);
    return fallback;
  }
};

// Fetch data from Supabase with Fallback
const featuredStories = await safeFetch(getFeaturedStories, mockStories);
const recentPosts = await safeFetch(getRecentPosts, mockRecent);
---

<BaseLayout title={pageTitle}>
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">
        Exploring the space between<br />
        <span class="text-serif italic">storytelling</span> and technology.
      </h1>
      <p class="hero-subtitle">
        I am <strong>Abodid</strong>. A creative technologist using photography, film, and code to build digital narratives.
      </p>
    </div>
  </section>

    <!-- Featured Work -->
  <section class="section">
    <div class="section-header">
      <h2>Photography</h2>
      <a href="/photography" class="link-arrow">View All</a>
    </div>
    
    <div class="grid-3">
      {featuredStories.map(story => (
        <StoryCard 
          title={story.title} 
          category={story.category} 
          image={story.image} 
          href={story.href} 
        />
      ))}
    </div>
  </section>

  <!-- Journal/Research Split -->
  <section class="section split-section">
    <div class="column">
      <div class="section-header">
        <h2>Journal</h2>
        <a href="/blog" class="link-arrow">Read all</a>
      </div>
      <ul class="journal-list">
        {recentPosts.map(post => (
          <li>
            <a href={post.href} class="journal-item">
              <span class="title">{post.title}</span>
              <span class="date">{post.date}</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
    
    <div class="column">
      <div class="section-header">
        <h2>Research</h2>
        <a href="/research" class="link-arrow">View Research</a>
      </div>
      <div class="code-preview">
        <p class="text-secondary">
          Deep research into the intersection of AI, sociology, and visual culture.
        </p>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .hero-section {
    min-height: 60vh;
    display: flex;
    align-items: center;
    margin-bottom: var(--space-2xl);
  }

  .hero-title {
    font-size: 3.5rem;
    font-weight: 600;
    line-height: 1.1;
    margin-bottom: 2rem;
    letter-spacing: -0.03em;
  }
  
  .italic {
    font-style: italic; 
    font-weight: 400;
  }

  .hero-subtitle {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 500px;
    font-weight: 300;
  }
  
  .section {
    margin-bottom: var(--space-2xl);
  }
  
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: var(--space-lg);
    border-bottom: 1px solid var(--border-subtle);
    padding-bottom: var(--space-md);
  }

  .link-arrow {
    font-size: var(--text-sm);
    font-weight: 500;
    position: relative;
    padding-right: 1.2em;
  }
  
  .link-arrow::after {
    content: "â†’";
    position: absolute;
    right: 0;
    transition: transform 0.2s ease;
  }
  
  .link-arrow:hover::after {
    transform: translateX(4px);
  }

  .split-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-2xl);
  }

  .journal-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .journal-item {
    display: flex;
    justify-content: space-between;
    padding: var(--space-md) 0;
    border-bottom: 1px solid var(--border-subtle);
  }
  
  .journal-item:hover .title {
    color: var(--text-secondary);
  }

  .journal-item .date {
    color: var(--text-tertiary);
    font-size: var(--text-xs);
    white-space: nowrap;
    margin-left: 1rem;
  }

  @media (max-width: 768px) {
    .hero-title { font-size: 2.5rem; }
    .split-section { grid-template-columns: 1fr; gap: var(--space-xl); }
  }
</style>
