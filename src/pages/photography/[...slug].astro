---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllPhotography, getPhotographyBySlug } from "../../lib/api";
import { marked } from "marked";
import ShareButtons from "../../components/ShareButtons.jsx";

export const prerender = false;

const { slug } = Astro.params;

const project = await getPhotographyBySlug(slug);

if (!project) {
  return Astro.redirect("/404");
}

const contentHtml = marked.parse(project.content || "");
---

<BaseLayout
  title={project.title}
  description={project.intro || project.description}
  image={project.cover_image}
>
  <article class="photography-article">
    <header class="project-header">
      <span class="meta">{project.date}</span>
      <h1>{project.title}</h1>
      <p class="intro text-serif">{project.intro}</p>
    </header>

    <div class="prose project-prose" set:html={contentHtml} />

    <div class="project-content gallery-grid">
      {
        project.images.map((img, index) => (
          <figure class="project-image">
            <img
              src={img}
              alt={`Photography image ${index + 1}`}
              loading="lazy"
            />
          </figure>
        ))
      }
    </div>

    <div class="story-footer">
      <ShareButtons
        client:only="react"
        title={project.title}
        url={Astro.url.href}
      />
      <a href="/photography" class="back-link">‚Üê Back to Photography</a>
    </div>
  </article>
</BaseLayout>

<style>
  .photography-article {
    max-width: 1052px; /* Align with navigation boundaries */
    margin: 0 auto;
    padding-top: var(--space-2xl);
  }

  .project-header {
    text-align: center;
    margin-bottom: var(--space-2xl);
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }

  .meta {
    font-size: 0.9rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: block;
    margin-bottom: 1rem;
  }

  h1 {
    font-size: 3rem;
    margin-bottom: 2rem;
  }

  .intro {
    font-size: 1.25rem;
    color: var(--text-secondary);
    line-height: 1.7;
  }

  .project-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .project-image {
    margin: 0; /* Remove default figure margins */
  }

  .project-image img {
    width: 100%;
    height: auto;
    display: block; /* Remove inline spacing */
    border-radius: 4px;
    /* Optional: minimal shadow for depth */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
  }

  .story-footer {
    margin-top: var(--space-2xl);
    padding-top: var(--space-lg);
    border-top: 1px solid var(--border-subtle);
    text-align: center;
  }

  .back-link {
    font-weight: 500;
  }

  .project-prose {
    font-family: var(--font-serif);
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--text-primary);
    max-width: 800px;
    margin: 0 auto;
  }

  .project-prose :global(img) {
    width: 100%;
    height: auto;
    border-radius: 4px;
    margin: 2rem 0;
  }

  .project-prose :global(p) {
    margin-bottom: 1.5rem;
  }

  .hidden-gallery {
    display: none;
  } /* Hide unless we have legacy images */

  /* Mobile adjustments for tighter spacing */
  @media (max-width: 900px) {
    /* Override container padding to achieve equal spacing */
    :global(.container) {
      padding-left: var(--space-md);
      padding-right: var(--space-md);
    }

    .photography-article {
      padding-left: 0;
      padding-right: 0;
    }

    .project-content {
      gap: var(--space-md); /* 1rem gap between images */
      padding: 0; /* No extra padding - container handles it */
    }

    .project-header {
      padding: 0;
    }

    .story-footer {
      padding-left: 0;
      padding-right: 0;
    }

    .project-prose {
      padding: 0;
    }
  }
</style>
