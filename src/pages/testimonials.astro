---
import BaseLayout from "../layouts/BaseLayout.astro";
import TestimonialsField from "../components/TestimonialsField";
import { supabase } from "../lib/supabase";

// Fetch testimonials from Supabase
let testimonials = [];
let error = null;

try {
    const { data, error: supabaseError } = await supabase
        .from("testimonials")
        .select("*")
        .eq("is_approved", true)
        .order("created_at", { ascending: false });

    if (supabaseError) {
        console.error("Supabase error fetching testimonials:", supabaseError);
        error = supabaseError.message;
    } else {
        testimonials = data || [];
    }
} catch (e) {
    console.error("Unexpected error fetching testimonials:", e);
    error = e.message;
}

const title = "Testimonials | Abodid Sahoo";
const description = "What people say about working with Abodid Sahoo.";
---

<BaseLayout title={title} description={description} fullWidth={true}>
    {/* Page Header (Constrained Width) */}
    <div class="page-container">
        <header class="page-header">
            <h1>Testimonials</h1>
            <p class="section-intro">
                What people say about working with Abodid Sahoo.
            </p>
        </header>
    </div>

    {/* Full Width Interactive Field */}
    <main class="min-h-screen">
        {
            error && (
                <div class="fixed top-24 left-1/2 -translate-x-1/2 z-50 p-4 border border-red-500 bg-red-100 text-red-700 rounded-lg">
                    Error loading testimonials: {error}
                </div>
            )
        }

        <TestimonialsField client:load testimonials={testimonials} />
    </main>
</BaseLayout>

<style>
    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding-left: 2rem;
        padding-right: 2rem;
        padding-top: 2rem; /* Added top padding inside container */
    }

    /* Header Styles (Matched from Films) */
    .page-header {
        margin-bottom: 4rem; /* Reduced from 5rem to be "a bit upwards" */
        text-align: left;
        /* Padding top handled by container + BaseLayout */
    }

    h1 {
        font-family: var(--font-display);
        font-size: 3.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        letter-spacing: -0.02em;
        color: var(--text-primary, #121212);
    }

    .section-intro {
        font-family: var(--font-sans, system-ui, sans-serif);
        font-size: 1.1rem;
        color: var(--text-secondary, #666);
        max-width: 600px;
        margin: 0;
        line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 768px) {
        h1 {
            font-size: 2.5rem;
        }
    }
</style>
